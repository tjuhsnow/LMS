<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_thjuh_lms.utils</api_name>
        <client_callable>false</client_callable>
        <description/>
        <name>utils</name>
        <script><![CDATA[var utils = Class.create();
utils.prototype = {
	initialize: function() {
		this.serviceID = gs.getProperty("x_thjuh_lms.service.account.id");
		this.servicePW = gs.getProperty("x_thjuh_lms.service.account.pw");
		this.cart = new sn_sc.CartJS();
	},

	//Addes new ritm to existing request. requred parms: request sys_id, item sys_id; optional parms: quantity
	//Variables on created new item are to be set ----TO DO----
	addRitmToReq: function(reqID, itemID, quantity){
		quantity = quantity || 1;
		var script = 'var reqHelper = new GlideappCalculationHelper();\n';
		script += 'reqHelper.addItemToExistingRequest("' + reqID + '", "' + itemID + '", "' + quantity + '");';
		var body = {name: "Inset New RITM to Existing Request", script: script, trigger_type: "0"};
		var endPoint = 'https://' + gs.getProperty('instance_name') + '.service-now.com/api/now/table/sys_trigger';
		return this._executeSNRest(endPoint, 'post', JSON.stringify(body));
	},

	//Submits new request with multiple items defined in items array for reqFor user
	//Sample items = [{ 'sysparm_id': '52bbf812db492300d61452b0cf96198a', 'sysparm_quantity': '1', 'variables':{ 'requesting_for': 'someoneelse', 'requested_for': '03668fd7db111300d61452b0cf961940', 'contact_number': '267-825-4535', 'basic_organization': 'center_city', 'department': '221f3db5c6112284009f4becd3039cc9', 'floor': '10', 'room': 'simLab' } }, { 'sysparm_id': '52bbf812db492300d61452b0cf96198a', 'sysparm_quantity': '1', 'variables':{ 'requesting_for': 'self', 'requested_for': '6816f79cc0a8016401c5a33be04be441', 'contact_number': '267-825-4535', 'basic_organization': 'center_city', 'department': '221f3db5c6112284009f4becd3039cc9', 'floor': '10', 'room': 'simLab' } } ];
	//where sysparm_id is the id of the catalog item to be added to the request
	submitNewRequest: function(reqFor, items, request){
		request = request || {}; 
		request.requested_for = reqFor;

		for(var i in items){
			var quantity = items[i]['sysparm_quantity'].toString() || '1';
			var item = {'sysparm_id': items[i]['sysparm_id'], 'sysparm_quantity': quantity, 'variables': items[i]['variables']};
			this._addItemToCart(item);
		}

		return this.cart.submitOrder(request);
	},

	_executeSNRest: function(url, method, body){
		var request = new sn_ws.RESTMessageV2();
		request.setEndpoint(url);
		request.setHttpMethod(method);
		request.setBasicAuth(this.serviceID, this.servicePW);
		request.setRequestHeader("Accept","application/json");
		request.setRequestHeader('Content-Type','application/json');
		request.setRequestBody(body);
		return request.execute();
	},
	
	_addItemToCart: function(item){
		var cart = new sn_sc.CartJS();
		cart.addToCart(item);
	},

	type: 'utils'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2018-10-12 02:25:10</sys_created_on>
        <sys_id>edebc352db816300d61452b0cf961940</sys_id>
        <sys_mod_count>26</sys_mod_count>
        <sys_name>utils</sys_name>
        <sys_package display_value="LMS" source="x_thjuh_lms">f5f1298edb8163406d31892a48961967</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="LMS">f5f1298edb8163406d31892a48961967</sys_scope>
        <sys_update_name>sys_script_include_edebc352db816300d61452b0cf961940</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2018-10-12 06:07:49</sys_updated_on>
    </sys_script_include>
</record_update>
